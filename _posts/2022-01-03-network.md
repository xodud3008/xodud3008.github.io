---
title: "네트워크 심화"
excerpt: "네트워크 심화. 인터넷 프로토콜, HTTP 헤더, 웹 캐시"

categories:
  - TIL
tags:
  - [Blog, jekyll, Github, Git, TIL, Javascript, linux, chmod, permission, node.js, 노드js, 자바스크립트, 백엔드, 네트워크 심화, 인터넷 프로토콜, HTTP 헤더, 웹 캐시, IP, TCP, UDP, HTTP]

toc: true
toc_sticky: true
 
date: 2022-01-03
last_modified_at: 2022-01-03
---
## 네트워크 심화
### 인터넷 프로토콜
#### IP 와 IP Packet
복잡한 인터넷 망 속에서 통신할 수 있도록 하는 규칙. IP 주소를 컴퓨터에 부여하고 지정한 주소에 패킷이라는 통신 단위로 데이터 전달.
##### IP 프로토콜의 한계
* 비연결성 : 패킷을 받을 대상이 없거나 서비스 불능 상태여도 패킷 전송
* 비신뢰성 : 중간에 패킷이 사라질 수 있음. 패킷의 순서를 보장할 수 없다.
  * 패킷의 용량이 크면 패킷을 나눠서 전송하는데 이때 의도하지 않은 순서로 도착할 수 있다.

#### TCP & UDP
##### 네트워크 프로토콜 계층
<center><img src="/assets/images/osi7.png" width="80%" height="100%" title="dbmvc" alt="사진"/></center>

* IP 프로토콜 보다 더 높은 계층에 TCP 프로토콜이 존재하기 때문에 IP 프로토콜의 한계를 보완할 수 있다.

##### 채팅 메세지를 보낼 때 어떤 일이 일어날까?
HTTP 메세지가 생성되면 Socket 라이브러리를 통해 전달 -> TCP 세그먼트 생성 -> IP 패킷 생성 -> TCP/IP 패킷이 물리적 계층을 지나기 위해 이더넷 프레임워크에 포함되어 서버로 전송

##### TCP/IP 구성
<img src="/assets/images/tcpip.png" width="50%" height="50%" title="dbmvc" alt="사진"/>

##### TCP : 전송 제어 프로토콜
같은 계층에 속한 UDP에 비해 상대적으로 신뢰할 수 있는 프로토콜
* 연결 지향 - TCP 3way handshake(가상 연결)
  * 연결 방식
    1. 클라이언트가 서버에 접속을 요청하는 SYN 패킷 전송
    2. SYN 패킷을 받은 서버가 요청을 수락하는 ACK와 SYN이 설정된 패킷 발송
    3. 클라이언트가 ACK 서버에 전송 => 연결 성립
    * 만약 서버가 꺼져있다면 클라이언트가 SYN을 보내고 서버에 응답이 없기 때문에 데이터를 보내지 않는다.
    * 현재는 최적화가 이루어져 3번 실행 시 데이터를 함께 보내기도 한다.
* 데이터 전달 보증 : 데이터 전송이 성공적으로 이루어지면 이에 대환 응답을 돌려주기 때문에 **비연결성** 보완
* 순서 보장 : 패킷이 순서대로 도착하지 않으면 TCP 세그먼트에 있는 정보를 토대로 다시 패킷 전송 요청하기 때문에 **비신뢰성** 보완
* 신뢰할 수 있는 프로토콜

##### UDP : 사용자 데이터그램 프로토콜
IP 프로토콜에 PORT, 체크섬 필드 정보만 추가된 단순한 프로토콜
* 하얀 도화지(기능이 거의 없다) : 커스터마이징 가능
* 데이터 전달 및 순서가 보장되지 않지만, 단순하고 빠름
* 신뢰성보다는 연속성이 중요한 서비스(e.g. 실시간 스트리밍)에 자주 사용

##### TUP vs UDP
|TCP|UDP|
|:--:|:--:|
|연결지향형 프로토콜|비 연결지향형 프로토콜|
|전송 순서 보장|전송 순서 보장 X|
|데이터 수신 여부 확인함|데이터 수신 여부 확인하지 않음|
|신뢰성 높음, 속도 느림|신뢰성 낮음, 속도 빠름|

#### HTTP
HTTP/1.1, HTTP/2는 TCP 기반, HTTP/3은 UDP 기반 프로토콜

##### 특징
* 클라이언트 서버 구조
  * Requdst Response 구조
  * 클라이언트는 서버에 요청을 보내고, 응답 대기
  * 서버가 요청에 대한 결과를 만들어 응답
* 무상태 프로토콜(ststeless), 비연결성(Connectionless)
* HTTP 메세지
* 단순함, 확장 가능

##### 무상태
* 클라이언트가 상태 유지(클라이언트가 더 많은 데이터를 전송해야 함). 서버는 상태를 보관하지 않는다.
* 중간에 서버가 변경되도 문제 없음 => 수평 확장 유리
* 실무 한계
  * 모든 것을 무상태로 설계할 수 있는 경우도 있고, 없는 경우도 있다.
  * 로그인이 필요없는 단순한 서비스 소개 화면(로그인 : 상태유지)
  * 로그인한 사용자의 경우 로그인했다는 상태를 서버에 유지(브라우저 쿠키, 서버 세션)
  * 상태 유지는 최소한만 사용

##### 비 연결성
* HTTP는 기본이 연결을 유지하지 않는 모델
* 일반적으로 초 단위 이하의 빠른 속도로 응답
* 1시간 동안 수천명이 서비스 사용해도 실제 서버에서 동시에 처리하는 요청은 수십개 이하로 매우 작음
* 한계
  * TCP/IP 연결을 새로 맺어야 함 - 3way handshake 시간 추가
  * 웹 브라우저로 사이트 요청하면 HTML, 자바스크립트, css, 추가 이미지 등 수많은 자원이 같이 다운됨
* 해결
  * HTTP 지속 연결로 문제 해결
  * HTTP/2, HTTP/3에서 더 많은 최적화 이루어짐